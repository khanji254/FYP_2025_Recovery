\section{Research Design and Methodology}
\label{sec:methodology}

This study will adopt an experimental and design-based research approach. The research will involve the modification and improvement of an existing image-based coffee berry sorting machine through systematic redesign of its mechanical, electrical, and software subsystems. A functional prototype will be developed and evaluated to determine improvements in sorting accuracy, processing speed, and system reliability. The research design will be iterative, where system performance will be evaluated at each stage, and necessary refinements will be implemented to address identified limitations such as motion blur, processing delays, and ejection timing inaccuracies observed in the previous model.

\subsection{System Overview}

The proposed coffee berry sorting machine will consist of three main modules:

\begin{itemize}
    \item \textbf{Mechanical Module} -- Responsible for controlled berry feeding, alignment, and physical support
    \item \textbf{Electrical and Electronic Module} -- Responsible for sensing, actuation, power distribution, and processing
    \item \textbf{Software Module} -- Responsible for image acquisition, processing, classification, tracking, and ejection control
\end{itemize}

\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{Figures/system_architecture.pdf}
\caption{Overall system architecture of the improved coffee berry sorting machine}
\label{fig:system_architecture}
\end{figure}

Each module will be designed to work in synchronization to enable real-time detection, classification, and rejection of unwanted coffee berries.

\subsection{Mechanical Module Design}

The mechanical module will be designed to ensure consistent berry flow, minimal vibration-induced image distortion, accurate alignment, and precise ejection positioning.

\subsubsection{Hopper}

The hopper will be used to store harvested coffee berries before sorting. It will be designed with sloped walls to allow gravity-assisted flow while preventing clogging and bridging of berries.

\textbf{Material Selection:} Mild steel sheet or food-grade aluminium will be used due to: structural strength, ease of fabrication, resistance to wear, and suitability for agricultural products. The hopper will feed berries uniformly onto the vibrating feeder.

\subsubsection{Linear Vibrating Feeder}

A linear vibrating feeder will be employed to regulate the flow rate of coffee berries and prevent overlapping during image capture. Controlled vibration will ensure berries are spread into a near-single-file arrangement.

\textbf{Justification:} Reduces berry overlap, improves image clarity, minimizes motion blur, and enhances object tracking accuracy.

\textbf{Material Selection:} Stainless steel or aluminium tray to reduce corrosion and contamination. Rubber vibration isolators to reduce transmission of vibration to the camera holder.

\subsubsection{Chute}

The chute will guide berries from the feeder to the imaging zone while maintaining alignment and spacing.

\textbf{Design Considerations:} Inclination angle optimized for gravity flow, smooth surface finish to reduce friction, fixed berry trajectory for predictable motion.

\textbf{Material Selection:} Acrylic or aluminium sheet chosen for smoothness, light weight, and ease of modification.

\subsubsection{Camera Holder}

The camera holder will support the Raspberry Pi camera directly above the imaging zone. It will be mechanically isolated from vibrations originating from the feeder.

\textbf{Design Improvements:} Use of rubber dampers to reduce vibration transmission, rigid frame mounting to maintain fixed focal distance, adjustable height mechanism for calibration.

\textbf{Material Selection:} Aluminium profile or 3D-printed ABS selected for rigidity and lightweight properties.

\subsubsection{Ejection Holder}

The ejection holder will house the air ejectors responsible for rejecting unwanted berries.

\textbf{Design Considerations:} Precise alignment with berry trajectory, fixed distance from detection zone to allow accurate ejection scheduling, modular design for easy adjustment.

\textbf{Material Selection:} Aluminium brackets resistant to vibration and compressed air forces.

\subsubsection{Frame Structure}

The frame will support all mechanical and electrical components.

\textbf{Material Selection:} Mild steel angle bars or aluminium extrusion selected for strength, stability, and ease of assembly.
\subsection{Proposed Electrical and Control Module}

The proposed electrical and control module will be designed to support high-speed image acquisition, real-time processing, and precise actuation required for accurate coffee berry sorting. To address the processing bottlenecks identified in the previous system, a co-processing architecture will be introduced.

\subsubsection{Central Processing and Co-Processing Architecture}

The system will employ a Raspberry Pi 3 as the main control and supervisory processing unit. The Raspberry Pi will be responsible for system initialization, user interface handling, data logging, actuator control, and coordination of the sorting process.

To improve throughput and reduce latency in image processing and classification, an additional microprocessor or co-processing unit (such as an ESP32, STM32, or equivalent embedded processor) will be introduced. This secondary processor will handle time-critical and repetitive computational tasks, thereby offloading the Raspberry Pi and enhancing real-time performance.

\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{Figures/coprocessing_architecture.pdf}
\caption{Co-processing architecture showing task distribution between Raspberry Pi and auxiliary microcontroller}
\label{fig:coprocessing_architecture}
\end{figure}

The division of tasks will be implemented as follows: The Raspberry Pi will manage high-level decision making, system synchronization, and communication. The co-processor will handle image pre-processing tasks, object tracking computations, timing calculations for ejection scheduling, and sensor signal conditioning where applicable.

Communication between the Raspberry Pi and the co-processor will be achieved through high-speed serial communication (UART, SPI, or IÂ²C), ensuring minimal data transfer delay or a flash disk.

\subsubsection{Image Acquisition System}

A Raspberry Pi Camera Module will be mounted above the chute using a rigid camera holder to capture high-resolution images of coffee berries in motion. The camera will operate at an optimized frame rate to balance image clarity and processing speed while minimizing motion blur.

Controlled LED lighting modules will be installed around the imaging zone to provide uniform illumination, reduce shadows, and ensure consistent image quality regardless of ambient lighting conditions.

\subsubsection{Air Ejection and Actuation System}

The berry rejection mechanism will consist of: high-speed air ejectors (solenoid-controlled air nozzles) positioned along the chute, and a compressed air supply system, including a compact air compressor and pressure regulation unit.

The co-processor will compute precise ejection timing based on berry position tracking, while the Raspberry Pi will issue final actuation commands. This approach will ensure accurate rejection of defective or unripe berries without affecting accepted berries.

\subsubsection{Motor Control and Power Supply}

Electric motors used in the linear vibrating feeder will be selected based on vibration frequency requirements, durability, and power efficiency. Motor drivers will be interfaced with the co-processor for precise control of feed rate.

The system will utilize: a regulated 5V DC supply for logic-level electronics (Raspberry Pi, microprocessor, camera), and a 12V DC supply for actuators, air solenoids, and motors.

Power isolation and protection mechanisms will be incorporated to prevent electrical noise from affecting sensitive processing units.

\subsection{Software Architecture and Control Logic}

The software system will be modular and executed in stages as outlined below:

\subsubsection{System Startup}

Upon power-up, the Raspberry Pi will initialize system peripherals, establish communication with the co-processor, and perform system diagnostics.

\subsubsection{Image Pre-Processing}

Captured images will undergo grayscale conversion, noise filtering, normalization, and contrast enhancement. Pre-processing tasks will primarily be executed on the co-processor to reduce computational load on the Raspberry Pi.

\subsubsection{Object Detection}

Coffee berries will be detected using thresholding and contour-based methods or lightweight machine learning models optimized for embedded systems.

\subsubsection{Object Tracking}

Detected berries will be tracked across successive frames to determine velocity and trajectory. Tracking data will be used to predict the precise point of ejection.

\subsubsection{Ejection Scheduling}

Based on classification results, the system will calculate the optimal actuation time for each air ejector to reject unwanted berries while allowing acceptable berries to pass.

\subsubsection{System Flow Control}

The Raspberry Pi will supervise the entire operation, adjusting feed rates, handling exceptions, and logging system performance metrics.
    \item Calculate metrics: sorting accuracy, false accept rate, false reject rate, throughput (kg/hr)
    \item Repeat testing for 5 batches to establish performance consistency
    \item Document failure modes and optimization opportunities
\end{enumerate}

Target performance metrics:
\begin{itemize}
    \item Sorting accuracy: $>$ 90\% (correctly classified berries / total berries)
    \item Throughput: 150-200 kg/hr (2.5x improvement over baseline 50-75 kg/hr)
    \item False accept rate: $<$ 8\% (defects in accepted stream)
    \item False reject rate: $<$ 12\% (good berries in rejected stream)
    \item System uptime: $>$ 95\% during 4-hour continuous operation test
\end{itemize}
